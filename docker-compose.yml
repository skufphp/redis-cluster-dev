services:
  redis-node1:
    image: redis:8.6-alpine
    container_name: redis-node1-dev
    user: "999:999"
    command: >
      redis-server --cluster-enabled yes
                         --cluster-config-file nodes.conf
                         --cluster-node-timeout 5000
                         --appendonly yes
                         --cluster-announce-ip redis-node1
                         --cluster-announce-port 6379
                         --cluster-announce-bus-port 16379
                         --maxmemory 2gb
                         --maxmemory-policy allkeys-lru
                         --save 900 1 60 100 30 10000
                         --tcp-keepalive 300
                         --tcp-backlog 511
    ports: [ "7001:6379" ]
    volumes: [ "./data/redis-node1:/data" ]
    networks: [ redis-cluster-dev ]
    restart: always
    healthcheck:
      test: [ "CMD", "redis-cli", "ping" ]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 40s
    deploy:
      resources:
        limits:
          memory: 2560M
          cpus: '1.0'
        reservations:
          memory: 1024M
          cpus: '0.5'


  redis-node2:
    image: redis:8.6-alpine
    container_name: redis-node2-dev
    user: "999:999"
    command: >
      redis-server --cluster-enabled yes
                         --cluster-config-file nodes.conf
                         --cluster-node-timeout 5000
                         --appendonly yes
                         --cluster-announce-ip redis-node2
                         --cluster-announce-port 6379
                         --cluster-announce-bus-port 16379
                         --maxmemory 2gb
                         --maxmemory-policy allkeys-lru
                         --save 900 1 60 100 30 10000
                         --tcp-keepalive 300
                         --tcp-backlog 511
    ports: [ "7002:6379" ]
    volumes: [ "./data/redis-node2:/data" ]
    networks: [ redis-cluster-dev ]
    restart: always
    healthcheck:
      test: [ "CMD", "redis-cli", "ping" ]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 40s
    deploy:
      resources:
        limits:
          memory: 2560M
          cpus: '1.0'
        reservations:
          memory: 1024M
          cpus: '0.5'

  redis-node3:
    image: redis:8.6-alpine
    container_name: redis-node3-dev
    user: "999:999"
    command: >
      redis-server --cluster-enabled yes
                         --cluster-config-file nodes.conf
                         --cluster-node-timeout 5000
                         --appendonly yes
                         --cluster-announce-ip redis-node3
                         --cluster-announce-port 6379
                         --cluster-announce-bus-port 16379
                         --maxmemory 2gb
                         --maxmemory-policy allkeys-lru
                         --save 900 1 60 100 30 10000
                         --tcp-keepalive 300
                         --tcp-backlog 511
    ports: [ "7003:6379" ]
    volumes: [ "./data/redis-node3:/data" ]
    networks: [ redis-cluster-dev ]
    restart: always
    healthcheck:
      test: [ "CMD", "redis-cli", "ping" ]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 40s
    deploy:
      resources:
        limits:
          memory: 2560M
          cpus: '1.0'
        reservations:
          memory: 1024M
          cpus: '0.5'

  redis-node4:
    image: redis:8.6-alpine
    container_name: redis-node4-dev
    user: "999:999"
    command: >
      redis-server --cluster-enabled yes
                         --cluster-config-file nodes.conf
                         --cluster-node-timeout 5000
                         --appendonly yes
                         --cluster-announce-ip redis-node4
                         --cluster-announce-port 6379
                         --cluster-announce-bus-port 16379
                         --maxmemory 2gb
                         --maxmemory-policy allkeys-lru
                         --save 900 1 60 100 30 10000
                         --tcp-keepalive 300
                         --tcp-backlog 511
    ports: [ "7004:6379" ]
    volumes: [ "./data/redis-node4:/data" ]
    networks: [ redis-cluster-dev ]
    restart: always
    healthcheck:
      test: [ "CMD", "redis-cli", "ping" ]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 40s
    deploy:
      resources:
        limits:
          memory: 2560M
          cpus: '1.0'
        reservations:
          memory: 1024M
          cpus: '0.5'

  redis-node5:
    image: redis:8.6-alpine
    container_name: redis-node5-dev
    user: "999:999"
    command: >
      redis-server --cluster-enabled yes
                         --cluster-config-file nodes.conf
                         --cluster-node-timeout 5000
                         --appendonly yes
                         --cluster-announce-ip redis-node5
                         --cluster-announce-port 6379
                         --cluster-announce-bus-port 16379
                         --maxmemory 2gb
                         --maxmemory-policy allkeys-lru
                         --save 900 1 60 100 30 10000
                         --tcp-keepalive 300
                         --tcp-backlog 511
    ports: [ "7005:6379" ]
    volumes: [ "./data/redis-node5:/data" ]
    networks: [ redis-cluster-dev ]
    restart: always
    healthcheck:
      test: [ "CMD", "redis-cli", "ping" ]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 40s
    deploy:
      resources:
        limits:
          memory: 2560M
          cpus: '1.0'
        reservations:
          memory: 1024M
          cpus: '0.5'

  redis-node6:
    image: redis:8.6-alpine
    container_name: redis-node6-dev
    user: "999:999"
    command: >
      redis-server --cluster-enabled yes
                         --cluster-config-file nodes.conf
                         --cluster-node-timeout 5000
                         --appendonly yes
                         --cluster-announce-ip redis-node6
                         --cluster-announce-port 6379
                         --cluster-announce-bus-port 16379
                         --maxmemory 2gb
                         --maxmemory-policy allkeys-lru
                         --save 900 1 60 100 30 10000
                         --tcp-keepalive 300
                         --tcp-backlog 511
    ports: [ "7006:6379" ]
    volumes: [ "./data/redis-node6:/data" ]
    networks: [ redis-cluster-dev ]
    restart: always
    healthcheck:
      test: [ "CMD", "redis-cli", "ping" ]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 40s
    deploy:
      resources:
        limits:
          memory: 2560M
          cpus: '1.0'
        reservations:
          memory: 1024M
          cpus: '0.5'

networks:
  redis-cluster-dev:
    name: redis-cluster-dev
    external: true
